jQuery.cookie=function(a,b,c){if("undefined"!=typeof b){c=c||{};null===b&&(b="",c.expires=-1);var d="";c.expires&&("number"==typeof c.expires||c.expires.toUTCString)&&("number"==typeof c.expires?(d=new Date,d.setTime(d.getTime()+864E5*c.expires)):d=c.expires,d="; expires="+d.toUTCString());var e=c.path?"; path="+c.path:"",g=c.domain?"; domain="+c.domain:"";c=c.secure?"; secure":"";document.cookie=[a,"=",encodeURIComponent(b),d,e,g,c].join("")}else{b=null;if(document.cookie&&""!=document.cookie)for(c=
document.cookie.split(";"),d=0;d<c.length;d++)if(e=jQuery.trim(c[d]),e.substring(0,a.length+1)==a+"="){b=decodeURIComponent(e.substring(a.length+1));break}return b}};var Sylvester={version:"0.1.3",precision:1E-6};function Vector(){}
Vector.prototype={e:function(a){return 1>a||a>this.elements.length?null:this.elements[a-1]},dimensions:function(){return this.elements.length},modulus:function(){return Math.sqrt(this.dot(this))},eql:function(a){var b=this.elements.length;a=a.elements||a;if(b!=a.length)return!1;do if(Math.abs(this.elements[b-1]-a[b-1])>Sylvester.precision)return!1;while(--b);return!0},dup:function(){return Vector.create(this.elements)},map:function(a){var b=[];this.each(function(c,d){b.push(a(c,d))});return Vector.create(b)},
each:function(a){var b=this.elements.length,c=b,d;do d=c-b,a(this.elements[d],d+1);while(--b)},toUnitVector:function(){var a=this.modulus();return 0===a?this.dup():this.map(function(b){return b/a})},angleFrom:function(a){var b=a.elements||a;if(this.elements.length!=b.length)return null;var c=0,d=0,e=0;this.each(function(a,f){c+=a*b[f-1];d+=a*a;e+=b[f-1]*b[f-1]});d=Math.sqrt(d);e=Math.sqrt(e);if(0===d*e)return null;a=c/(d*e);-1>a&&(a=-1);1<a&&(a=1);return Math.acos(a)},isParallelTo:function(a){a=this.angleFrom(a);
return null===a?null:a<=Sylvester.precision},isAntiparallelTo:function(a){a=this.angleFrom(a);return null===a?null:Math.abs(a-Math.PI)<=Sylvester.precision},isPerpendicularTo:function(a){a=this.dot(a);return null===a?null:Math.abs(a)<=Sylvester.precision},add:function(a){var b=a.elements||a;return this.elements.length!=b.length?null:this.map(function(a,d){return a+b[d-1]})},subtract:function(a){var b=a.elements||a;return this.elements.length!=b.length?null:this.map(function(a,d){return a-b[d-1]})},
multiply:function(a){return this.map(function(b){return b*a})},x:function(a){return this.multiply(a)},dot:function(a){a=a.elements||a;var b=0,c=this.elements.length;if(c!=a.length)return null;do b+=this.elements[c-1]*a[c-1];while(--c);return b},cross:function(a){a=a.elements||a;if(3!=this.elements.length||3!=a.length)return null;var b=this.elements;return Vector.create([b[1]*a[2]-b[2]*a[1],b[2]*a[0]-b[0]*a[2],b[0]*a[1]-b[1]*a[0]])},max:function(){var a=0,b=this.elements.length,c=b,d;do d=c-b,Math.abs(this.elements[d])>
Math.abs(a)&&(a=this.elements[d]);while(--b);return a},indexOf:function(a){var b=null,c=this.elements.length,d=c,e;do e=d-c,null===b&&this.elements[e]==a&&(b=e+1);while(--c);return b},toDiagonalMatrix:function(){return Matrix.Diagonal(this.elements)},round:function(a){return a instanceof Array?this.map(function(b,c){return Math.round(b/a[c-1])*a[c-1]}):this.map(function(b){return void 0===a?Math.round(b):Math.round(b/a)*a})},snapTo:function(a){return this.map(function(b){return Math.abs(b-a)<=Sylvester.precision?
a:b})},distanceFrom:function(a){if(a.anchor)return a.distanceFrom(this);var b=a.elements||a;if(b.length!=this.elements.length)return null;var c=0,d;this.each(function(a,g){d=a-b[g-1];c+=d*d});return Math.sqrt(c)},liesOn:function(a){return a.contains(this)},liesIn:function(a){return a.contains(this)},rotate:function(a,b){var c,d,e,g;switch(this.elements.length){case 2:c=b.elements||b;if(2!=c.length)return null;d=Matrix.Rotation(a).elements;e=this.elements[0]-c[0];g=this.elements[1]-c[1];return Vector.create([c[0]+
d[0][0]*e+d[0][1]*g,c[1]+d[1][0]*e+d[1][1]*g]);case 3:if(!b.direction)return null;var f=b.pointClosestTo(this).elements;d=Matrix.Rotation(a,b.direction).elements;e=this.elements[0]-f[0];g=this.elements[1]-f[1];c=this.elements[2]-f[2];return Vector.create([f[0]+d[0][0]*e+d[0][1]*g+d[0][2]*c,f[1]+d[1][0]*e+d[1][1]*g+d[1][2]*c,f[2]+d[2][0]*e+d[2][1]*g+d[2][2]*c]);default:return null}},reflectionIn:function(a){if(a.anchor){var b=this.elements.slice();a=a.pointClosestTo(b).elements;return Vector.create([a[0]+
(a[0]-b[0]),a[1]+(a[1]-b[1]),a[2]+(a[2]-(b[2]||0))])}var c=a.elements||a;return this.elements.length!=c.length?null:this.map(function(a,b){return c[b-1]+(c[b-1]-a)})},to3D:function(){var a=this.dup();switch(a.elements.length){case 3:break;case 2:a.elements.push(0);break;default:return null}return a},inspect:function(){return"["+this.elements.join(", ")+"]"},setElements:function(a){this.elements=(a.elements||a).slice();return this}};Vector.create=function(a){return(new Vector).setElements(a)};
Vector.i=Vector.create([1,0,0]);Vector.j=Vector.create([0,1,0]);Vector.k=Vector.create([0,0,1]);Vector.Random=function(a){var b=[];do b.push(Math.random());while(--a);return Vector.create(b)};Vector.Zero=function(a){var b=[];do b.push(0);while(--a);return Vector.create(b)};function Matrix(){}
Matrix.prototype={e:function(a,b){return 1>a||a>this.elements.length||1>b||b>this.elements[0].length?null:this.elements[a-1][b-1]},row:function(a){return a>this.elements.length?null:Vector.create(this.elements[a-1])},col:function(a){if(a>this.elements[0].length)return null;var b=[],c=this.elements.length,d=c,e;do e=d-c,b.push(this.elements[e][a-1]);while(--c);return Vector.create(b)},dimensions:function(){return{rows:this.elements.length,cols:this.elements[0].length}},rows:function(){return this.elements.length},
cols:function(){return this.elements[0].length},eql:function(a){a=a.elements||a;"undefined"==typeof a[0][0]&&(a=Matrix.create(a).elements);if(this.elements.length!=a.length||this.elements[0].length!=a[0].length)return!1;var b=this.elements.length,c=b,d,e,g=this.elements[0].length,f;do{d=c-b;e=g;do if(f=g-e,Math.abs(this.elements[d][f]-a[d][f])>Sylvester.precision)return!1;while(--e)}while(--b);return!0},dup:function(){return Matrix.create(this.elements)},map:function(a){var b=[],c=this.elements.length,
d=c,e,g,f=this.elements[0].length,h;do{e=d-c;g=f;b[e]=[];do h=f-g,b[e][h]=a(this.elements[e][h],e+1,h+1);while(--g)}while(--c);return Matrix.create(b)},isSameSizeAs:function(a){a=a.elements||a;"undefined"==typeof a[0][0]&&(a=Matrix.create(a).elements);return this.elements.length==a.length&&this.elements[0].length==a[0].length},add:function(a){var b=a.elements||a;"undefined"==typeof b[0][0]&&(b=Matrix.create(b).elements);return this.isSameSizeAs(b)?this.map(function(a,d,e){return a+b[d-1][e-1]}):null},
subtract:function(a){var b=a.elements||a;"undefined"==typeof b[0][0]&&(b=Matrix.create(b).elements);return this.isSameSizeAs(b)?this.map(function(a,d,e){return a-b[d-1][e-1]}):null},canMultiplyFromLeft:function(a){a=a.elements||a;"undefined"==typeof a[0][0]&&(a=Matrix.create(a).elements);return this.elements[0].length==a.length},multiply:function(a){if(!a.elements)return this.map(function(b){return b*a});var b=a.modulus?!0:!1,c=a.elements||a;"undefined"==typeof c[0][0]&&(c=Matrix.create(c).elements);
if(!this.canMultiplyFromLeft(c))return null;var d=this.elements.length,e=d,g,f,h=c[0].length,k,l=this.elements[0].length,m=[],n,x,r;do{g=e-d;m[g]=[];f=h;do{k=h-f;n=0;x=l;do r=l-x,r=this.elements[g][r]*c[r][k],n+=r;while(--x);m[g][k]=n}while(--f)}while(--d);c=Matrix.create(m);return b?c.col(1):c},x:function(a){return this.multiply(a)},minor:function(a,b,c,d){var e=[],g=c,f,h,k,l=this.elements.length,m=this.elements[0].length;do{f=c-g;e[f]=[];h=d;do k=d-h,e[f][k]=this.elements[(a+f-1)%l][(b+k-1)%m];
while(--h)}while(--g);return Matrix.create(e)},transpose:function(){var a=this.elements.length,b=this.elements[0].length,c=[],d=b,e,g,f;do{e=b-d;c[e]=[];g=a;do f=a-g,c[e][f]=this.elements[f][e];while(--g)}while(--d);return Matrix.create(c)},isSquare:function(){return this.elements.length==this.elements[0].length},max:function(){var a=0,b=this.elements.length,c=b,d,e,g=this.elements[0].length,f;do{d=c-b;e=g;do f=g-e,Math.abs(this.elements[d][f])>Math.abs(a)&&(a=this.elements[d][f]);while(--e)}while(--b);
return a},indexOf:function(a){var b=this.elements.length,c=b,d,e,g=this.elements[0].length,f;do{d=c-b;e=g;do if(f=g-e,this.elements[d][f]==a)return{i:d+1,j:f+1};while(--e)}while(--b);return null},diagonal:function(){if(!this.isSquare)return null;var a=[],b=this.elements.length,c=b,d;do d=c-b,a.push(this.elements[d][d]);while(--b);return Vector.create(a)},toRightTriangular:function(){var a=this.dup(),b,c=this.elements.length,d=c,e,g,f=this.elements[0].length,h;do{e=d-c;if(0==a.elements[e][e])for(j=
e+1;j<d;j++)if(0!=a.elements[j][e]){b=[];g=f;do h=f-g,b.push(a.elements[e][h]+a.elements[j][h]);while(--g);a.elements[e]=b;break}if(0!=a.elements[e][e])for(j=e+1;j<d;j++){var k=a.elements[j][e]/a.elements[e][e];b=[];g=f;do h=f-g,b.push(h<=e?0:a.elements[j][h]-a.elements[e][h]*k);while(--g);a.elements[j]=b}}while(--c);return a},toUpperTriangular:function(){return this.toRightTriangular()},determinant:function(){if(!this.isSquare())return null;var a=this.toRightTriangular(),b=a.elements[0][0],c=a.elements.length-
1,d=c,e;do e=d-c+1,b*=a.elements[e][e];while(--c);return b},det:function(){return this.determinant()},isSingular:function(){return this.isSquare()&&0===this.determinant()},trace:function(){if(!this.isSquare())return null;var a=this.elements[0][0],b=this.elements.length-1,c=b,d;do d=c-b+1,a+=this.elements[d][d];while(--b);return a},tr:function(){return this.trace()},rank:function(){var a=this.toRightTriangular(),b=0,c=this.elements.length,d=c,e,g,f=this.elements[0].length,h;do{e=d-c;g=f;do if(h=f-
g,Math.abs(a.elements[e][h])>Sylvester.precision){b++;break}while(--g)}while(--c);return b},rk:function(){return this.rank()},augment:function(a){a=a.elements||a;"undefined"==typeof a[0][0]&&(a=Matrix.create(a).elements);var b=this.dup(),c=b.elements[0].length,d=b.elements.length,e=d,g,f,h=a[0].length,k;if(d!=a.length)return null;do{g=e-d;f=h;do k=h-f,b.elements[g][c+k]=a[g][k];while(--f)}while(--d);return b},inverse:function(){if(!this.isSquare()||this.isSingular())return null;var a=this.elements.length,
b=a,c,d,e=this.augment(Matrix.I(a)).toRightTriangular(),g,f=e.elements[0].length,h,k,l=[],m;do{c=a-1;k=[];g=f;l[c]=[];d=e.elements[c][c];do h=f-g,m=e.elements[c][h]/d,k.push(m),h>=b&&l[c].push(m);while(--g);e.elements[c]=k;for(d=0;d<c;d++){k=[];g=f;do h=f-g,k.push(e.elements[d][h]-e.elements[c][h]*e.elements[d][c]);while(--g);e.elements[d]=k}}while(--a);return Matrix.create(l)},inv:function(){return this.inverse()},round:function(a){return a instanceof Array?this.map(function(b,c){return Math.round(b/
a[c-1])*a[c-1]}):this.map(function(b){return void 0===a?Math.round(b):Math.round(b/a)*a})},snapTo:function(a){return this.map(function(b){return Math.abs(b-a)<=Sylvester.precision?a:b})},inspect:function(){var a=[],b=this.elements.length,c=b,d;do d=c-b,a.push(Vector.create(this.elements[d]).inspect());while(--b);return a.join("\n")},setElements:function(a){var b=a.elements||a;if("undefined"!=typeof b[0][0]){var c=b.length,d=c,e,g,f;this.elements=[];do{a=d-c;g=e=b[a].length;this.elements[a]=[];do f=
g-e,this.elements[a][f]=b[a][f];while(--e)}while(--c);return this}d=c=b.length;this.elements=[];do a=d-c,this.elements.push([b[a]]);while(--c);return this}};Matrix.create=function(a){return(new Matrix).setElements(a)};Matrix.I=function(a){var b=[],c=a,d,e,g;do{d=c-a;b[d]=[];e=c;do g=c-e,b[d][g]=d==g?1:0;while(--e)}while(--a);return Matrix.create(b)};Matrix.Diagonal=function(a){var b=a.length,c=b,d,e=Matrix.I(b);do d=c-b,e.elements[d][d]=a[d];while(--b);return e};
Matrix.Rotation=function(a,b){if(!b)return Matrix.create([[Math.cos(a),-Math.sin(a)],[Math.sin(a),Math.cos(a)]]);var c=b.dup();if(3!=c.elements.length)return null;var d=c.modulus(),e=c.elements[0]/d,g=c.elements[1]/d,c=c.elements[2]/d,d=Math.sin(a),f=Math.cos(a),h=1-f;return Matrix.create([[h*e*e+f,h*e*g-d*c,h*e*c+d*g],[h*e*g+d*c,h*g*g+f,h*g*c-d*e],[h*e*c-d*g,h*g*c+d*e,h*c*c+f]])};Matrix.RotationX=function(a){var b=Math.cos(a);a=Math.sin(a);return Matrix.create([[1,0,0],[0,b,-a],[0,a,b]])};
Matrix.RotationY=function(a){var b=Math.cos(a);a=Math.sin(a);return Matrix.create([[b,0,a],[0,1,0],[-a,0,b]])};Matrix.RotationZ=function(a){var b=Math.cos(a);a=Math.sin(a);return Matrix.create([[b,-a,0],[a,b,0],[0,0,1]])};Matrix.Random=function(a,b){return Matrix.Zero(a,b).map(function(){return Math.random()})};Matrix.Zero=function(a,b){var c=[],d=a,e,g,f;do{e=a-d;c[e]=[];g=b;do f=b-g,c[e][f]=0;while(--g)}while(--d);return Matrix.create(c)};function Line(){}
Line.prototype={eql:function(a){return this.isParallelTo(a)&&this.contains(a.anchor)},dup:function(){return Line.create(this.anchor,this.direction)},translate:function(a){a=a.elements||a;return Line.create([this.anchor.elements[0]+a[0],this.anchor.elements[1]+a[1],this.anchor.elements[2]+(a[2]||0)],this.direction)},isParallelTo:function(a){if(a.normal)return a.isParallelTo(this);a=this.direction.angleFrom(a.direction);return Math.abs(a)<=Sylvester.precision||Math.abs(a-Math.PI)<=Sylvester.precision},
distanceFrom:function(a){if(a.normal)return a.distanceFrom(this);if(a.direction){if(this.isParallelTo(a))return this.distanceFrom(a.anchor);var b=this.direction.cross(a.direction).toUnitVector().elements,c=this.anchor.elements;a=a.anchor.elements;return Math.abs((c[0]-a[0])*b[0]+(c[1]-a[1])*b[1]+(c[2]-a[2])*b[2])}var d=a.elements||a,c=this.anchor.elements,b=this.direction.elements;a=d[0]-c[0];var e=d[1]-c[1],d=(d[2]||0)-c[2],c=Math.sqrt(a*a+e*e+d*d);if(0===c)return 0;b=(a*b[0]+e*b[1]+d*b[2])/c;b=
1-b*b;return Math.abs(c*Math.sqrt(0>b?0:b))},contains:function(a){a=this.distanceFrom(a);return null!==a&&a<=Sylvester.precision},liesIn:function(a){return a.contains(this)},intersects:function(a){return a.normal?a.intersects(this):!this.isParallelTo(a)&&this.distanceFrom(a)<=Sylvester.precision},intersectionWith:function(a){if(a.normal)return a.intersectionWith(this);if(!this.intersects(a))return null;var b=this.anchor.elements,c=this.direction.elements,d=a.anchor.elements,e=a.direction.elements;
a=c[0];var g=c[1],c=c[2],f=e[0],h=e[1],e=e[2],k=b[0]-d[0],l=b[1]-d[1],d=b[2]-d[2],m=f*f+h*h+e*e,n=a*f+g*h+c*e,f=((-a*k-g*l-c*d)*m/(a*a+g*g+c*c)+n*(f*k+h*l+e*d))/(m-n*n);return Vector.create([b[0]+f*a,b[1]+f*g,b[2]+f*c])},pointClosestTo:function(a){if(a.direction){if(this.intersects(a))return this.intersectionWith(a);if(this.isParallelTo(a))return null;var b=this.direction.elements,c=a.direction.elements,d=b[0],e=b[1],b=b[2],g=c[0],f=c[1],h=c[2],c=b*g-d*h,k=d*f-e*g,l=e*h-b*f,d=Vector.create([c*h-k*
f,k*g-l*h,l*f-c*g]);a=Plane.create(a.anchor,d);return a.intersectionWith(this)}a=a.elements||a;if(this.contains(a))return Vector.create(a);c=this.anchor.elements;b=this.direction.elements;d=b[0];e=b[1];b=b[2];g=c[0];k=c[1];f=c[2];c=d*(a[1]-k)-e*(a[0]-g);k=e*((a[2]||0)-f)-b*(a[1]-k);l=b*(a[0]-g)-d*((a[2]||0)-f);d=Vector.create([e*c-b*l,b*k-d*c,d*l-e*k]);e=this.distanceFrom(a)/d.modulus();return Vector.create([a[0]+d.elements[0]*e,a[1]+d.elements[1]*e,(a[2]||0)+d.elements[2]*e])},rotate:function(a,
b){"undefined"==typeof b.direction&&(b=Line.create(b.to3D(),Vector.k));var c=Matrix.Rotation(a,b.direction).elements,d=b.pointClosestTo(this.anchor).elements,e=this.anchor.elements,g=this.direction.elements,f=d[0],h=d[1],d=d[2],k=e[0]-f,l=e[1]-h,e=e[2]-d;return Line.create([f+c[0][0]*k+c[0][1]*l+c[0][2]*e,h+c[1][0]*k+c[1][1]*l+c[1][2]*e,d+c[2][0]*k+c[2][1]*l+c[2][2]*e],[c[0][0]*g[0]+c[0][1]*g[1]+c[0][2]*g[2],c[1][0]*g[0]+c[1][1]*g[1]+c[1][2]*g[2],c[2][0]*g[0]+c[2][1]*g[1]+c[2][2]*g[2]])},reflectionIn:function(a){if(a.normal){var b=
this.anchor.elements,c=this.direction.elements,d=b[0],e=b[1],b=b[2],g=c[0],f=c[1],h=c[2],c=this.anchor.reflectionIn(a).elements,d=d+g,e=e+f,b=b+h;a=a.pointClosestTo([d,e,b]).elements;return Line.create(c,[a[0]+(a[0]-d)-c[0],a[1]+(a[1]-e)-c[1],a[2]+(a[2]-b)-c[2]])}if(a.direction)return this.rotate(Math.PI,a);a=a.elements||a;return Line.create(this.anchor.reflectionIn([a[0],a[1],a[2]||0]),this.direction)},setVectors:function(a,b){a=Vector.create(a);b=Vector.create(b);2==a.elements.length&&a.elements.push(0);
2==b.elements.length&&b.elements.push(0);if(3<a.elements.length||3<b.elements.length)return null;var c=b.modulus();if(0===c)return null;this.anchor=a;this.direction=Vector.create([b.elements[0]/c,b.elements[1]/c,b.elements[2]/c]);return this}};Line.create=function(a,b){return(new Line).setVectors(a,b)};Line.X=Line.create(Vector.Zero(3),Vector.i);Line.Y=Line.create(Vector.Zero(3),Vector.j);Line.Z=Line.create(Vector.Zero(3),Vector.k);function Plane(){}
Plane.prototype={eql:function(a){return this.contains(a.anchor)&&this.isParallelTo(a)},dup:function(){return Plane.create(this.anchor,this.normal)},translate:function(a){a=a.elements||a;return Plane.create([this.anchor.elements[0]+a[0],this.anchor.elements[1]+a[1],this.anchor.elements[2]+(a[2]||0)],this.normal)},isParallelTo:function(a){return a.normal?(a=this.normal.angleFrom(a.normal),Math.abs(a)<=Sylvester.precision||Math.abs(Math.PI-a)<=Sylvester.precision):a.direction?this.normal.isPerpendicularTo(a.direction):
null},isPerpendicularTo:function(a){a=this.normal.angleFrom(a.normal);return Math.abs(Math.PI/2-a)<=Sylvester.precision},distanceFrom:function(a){if(this.intersects(a)||this.contains(a))return 0;if(a.anchor){var b=this.anchor.elements,c=a.anchor.elements;a=this.normal.elements;return Math.abs((b[0]-c[0])*a[0]+(b[1]-c[1])*a[1]+(b[2]-c[2])*a[2])}c=a.elements||a;b=this.anchor.elements;a=this.normal.elements;return Math.abs((b[0]-c[0])*a[0]+(b[1]-c[1])*a[1]+(b[2]-(c[2]||0))*a[2])},contains:function(a){if(a.normal)return null;
if(a.direction)return this.contains(a.anchor)&&this.contains(a.anchor.add(a.direction));a=a.elements||a;var b=this.anchor.elements,c=this.normal.elements;return Math.abs(c[0]*(b[0]-a[0])+c[1]*(b[1]-a[1])+c[2]*(b[2]-(a[2]||0)))<=Sylvester.precision},intersects:function(a){return"undefined"==typeof a.direction&&"undefined"==typeof a.normal?null:!this.isParallelTo(a)},intersectionWith:function(a){if(!this.intersects(a))return null;if(a.direction){var b=a.anchor.elements,c=a.direction.elements;a=this.anchor.elements;
var d=this.normal.elements;a=(d[0]*(a[0]-b[0])+d[1]*(a[1]-b[1])+d[2]*(a[2]-b[2]))/(d[0]*c[0]+d[1]*c[1]+d[2]*c[2]);return Vector.create([b[0]+c[0]*a,b[1]+c[1]*a,b[2]+c[2]*a])}if(a.normal){var c=this.normal.cross(a.normal).toUnitVector(),d=this.normal.elements,b=this.anchor.elements,e=a.normal.elements,g=a.anchor.elements,f=Matrix.Zero(2,2);for(a=0;f.isSingular();)a++,f=Matrix.create([[d[a%3],d[(a+1)%3]],[e[a%3],e[(a+1)%3]]]);f=f.inverse().elements;b=d[0]*b[0]+d[1]*b[1]+d[2]*b[2];d=e[0]*g[0]+e[1]*g[1]+
e[2]*g[2];b=[f[0][0]*b+f[0][1]*d,f[1][0]*b+f[1][1]*d];d=[];for(e=1;3>=e;e++)d.push(a==e?0:b[(e+(5-a)%3)%3]);return Line.create(d,c)}},pointClosestTo:function(a){a=a.elements||a;var b=this.anchor.elements,c=this.normal.elements,b=(b[0]-a[0])*c[0]+(b[1]-a[1])*c[1]+(b[2]-(a[2]||0))*c[2];return Vector.create([a[0]+c[0]*b,a[1]+c[1]*b,(a[2]||0)+c[2]*b])},rotate:function(a,b){var c=Matrix.Rotation(a,b.direction).elements,d=b.pointClosestTo(this.anchor).elements,e=this.anchor.elements,g=this.normal.elements,
f=d[0],h=d[1],d=d[2],k=e[0]-f,l=e[1]-h,e=e[2]-d;return Plane.create([f+c[0][0]*k+c[0][1]*l+c[0][2]*e,h+c[1][0]*k+c[1][1]*l+c[1][2]*e,d+c[2][0]*k+c[2][1]*l+c[2][2]*e],[c[0][0]*g[0]+c[0][1]*g[1]+c[0][2]*g[2],c[1][0]*g[0]+c[1][1]*g[1]+c[1][2]*g[2],c[2][0]*g[0]+c[2][1]*g[1]+c[2][2]*g[2]])},reflectionIn:function(a){if(a.normal){var b=this.anchor.elements,c=this.normal.elements,d=b[0],e=b[1],b=b[2],g=c[0],f=c[1],h=c[2],c=this.anchor.reflectionIn(a).elements,d=d+g,e=e+f,b=b+h;a=a.pointClosestTo([d,e,b]).elements;
return Plane.create(c,[a[0]+(a[0]-d)-c[0],a[1]+(a[1]-e)-c[1],a[2]+(a[2]-b)-c[2]])}if(a.direction)return this.rotate(Math.PI,a);a=a.elements||a;return Plane.create(this.anchor.reflectionIn([a[0],a[1],a[2]||0]),this.normal)},setVectors:function(a,b,c){a=Vector.create(a);a=a.to3D();if(null===a)return null;b=Vector.create(b);b=b.to3D();if(null===b)return null;if("undefined"==typeof c)c=null;else if(c=Vector.create(c),c=c.to3D(),null===c)return null;var d=a.elements[0],e=a.elements[1],g=a.elements[2],
f=b.elements[0],h=b.elements[1],k=b.elements[2];if(null!==c){b=c.elements[0];var l=c.elements[1];c=c.elements[2];e=Vector.create([(h-e)*(c-g)-(k-g)*(l-e),(k-g)*(b-d)-(f-d)*(c-g),(f-d)*(l-e)-(h-e)*(b-d)]);d=e.modulus();if(0===d)return null;e=Vector.create([e.elements[0]/d,e.elements[1]/d,e.elements[2]/d])}else{d=Math.sqrt(f*f+h*h+k*k);if(0===d)return null;e=Vector.create([b.elements[0]/d,b.elements[1]/d,b.elements[2]/d])}this.anchor=a;this.normal=e;return this}};
Plane.create=function(a,b,c){return(new Plane).setVectors(a,b,c)};Plane.XY=Plane.create(Vector.Zero(3),Vector.k);Plane.YZ=Plane.create(Vector.Zero(3),Vector.i);Plane.ZX=Plane.create(Vector.Zero(3),Vector.j);Plane.YX=Plane.XY;Plane.ZY=Plane.YZ;Plane.XZ=Plane.ZX;
var $V=Vector.create,$M=Matrix.create,$L=Line.create,$P=Plane.create,formulas={bookformula1:{getMatrix:function(a){return[[a[0]-1,-1],[-1,a[1]-1]]}},bookformula2:{getMatrix:function(a){return[[a[0]-1,-1,-1],[-1,a[1]-1,-1],[-1,-1,a[2]-1]]}},bookformula3:{getMatrix:function(a){return[[a[0]-1,-1,-1],[0,a[1]-1,-1],[-1,-1,a[2]-1]]}},bookformula4:{getMatrix:function(a){var b=a[1];return[[a[0]-1,-1,-1],[0,b-1,-1],[-1,b-1,a[2]-1]]}},bookformula5:{getMatrix:function(a){return[[a[0]-1,-1,-1],[-.5,a[1]-1,-1],
[-1,-1,a[2]-1]]}},bookformula6:{getMatrix:function(a){var b=a[1];return[[a[0]-1,-1,-1],[-.5,b-1,-1],[-1,b-1,a[2]-1]]}},bookformula7:{getMatrix:function(a){var b=a[0];return[[b-1,-1,-1],[(b-1)/2,a[1]-1,-1],[-1,-1,a[2]-1]]}},bookformula8:{getMatrix:function(a){var b=a[0],c=a[1];return[[b-1,-1,-1],[(b-1)/2,c-1,-1],[-1,c-1,a[2]-1]]}},bookformula9:{getMatrix:function(a){return[[a[0]-1,-1,-1],[-.5,a[1]-1,0],[-1,-1,a[2]-1]]}},bookformula10:{getMatrix:function(a){var b=a[1];return[[a[0]-1,-1,-1],[-.5,b-1,
0],[-1,b-1,a[2]-1]]}},bookformula11:{getMatrix:function(a){return[[a[0]-1,-1,-1],[-.5,a[1]-1,-.5],[-1,-1,a[2]-1]]}},bookformula12:{getMatrix:function(a){return[[a[0]-1,-1,-1],[-.5,a[1]-1,-.5],[-1,-1,a[2]-1]]}},bookformula13:{getMatrix:function(a){var b=a[1];return[[a[0]-1,-1,-1],[0,(b-1)/2,-1],[-1,b-1,a[2]-1]]}},bookformula14:{getMatrix:function(a){var b=a[1];return[[a[0]-1,-1,-1],[0,b-1,-.5],[-1,b-1,a[2]-1]]}},bookformula15:{getMatrix:function(a){var b=a[0];return[[b-1,-1,-1],[(b-1)/2,0,-1],[-1,
a[1]-1,a[2]-1]]}},bookformula16:{getMatrix:function(a){var b=a[0],c=a[1];a=a[2];return[[b-1,c-1,-1],[b-1,-1,a-1],[-1,c-1,a-1]]}},bookformula17:{getMatrix:function(a){var b=a[0],c=a[1];a=a[2];return[[b-1,c-1,-1],[(b-1)/2,-1,a-1],[-1,c-1,a-1]]}},bookformula18:{getMatrix:function(a){var b=a[0],c=a[1];a=a[2];return[[b-1,c-1,-1],[(b-1)/2,-1,(a-1)/2],[-1,c-1,a-1]]}},bookformula19:{getMatrix:function(a){var b=a[1],c=a[2];return[[a[0]-1,b-1,-1],[0,-1,c-1],[-1,b-1,c-1]]}},bookformula20:{getMatrix:function(a){var b=
a[1],c=a[2];return[[a[0]-1,b-1,-1],[0,-1,(c-1)/2],[-1,b-1,c-1]]}},bookformula21:{getMatrix:function(a){var b=a[0],c=a[1];return[[b-1,-1,-1],[(b-1)/2,(c-1)/2,-1],[-1,c-1,a[2]-1]]}},universalFormulaSimple:{getMatrix:function(a,b){for(var c=Array(b),d=0,e=0,d=0;d<b;d++)for(c[d]=Array(b),e=0;e<b;e++)c[d][e]=d==e?a[d]-1:-1;return c}}},forktypes=[{prongs:{en:["Win 1","Win 2"],de:["Gewinn 1","Gewinn 2"],fr:["V1","V2"],ru:["\u041f1","\u041f2"]},formula:"bookformula1"},{prongs:{en:["1","X2"],de:["1","X2"],
fr:["1","X2"],ru:["1","X2"]},formula:"bookformula1"},{prongs:{en:["1X","2"],de:["1X","2"],fr:["1X","2"],ru:["1X","2"]},formula:"bookformula1"},{prongs:{en:["H1()","H2()"],de:["AH1()","AH2()"],fr:["HA1()","HA2()"],ru:["\u04241()","\u04242()"]},formula:"bookformula1"},{prongs:{en:["Over ","Under "],de:["\u00dcber ","Unter "],fr:["Tp()","Tm()"],ru:["\u0422\u0431()","\u0422\u043c()"]},formula:"bookformula1"},{prongs:{en:["1","X","2"],de:["1","X","2"],fr:["1","X","2"],ru:["1","X","2"]},formula:"bookformula2"},
{prongs:{en:["H1(0.0)","X","2"],de:["AH1(0.0)","X","2"],fr:["HA1(0.0)","X","2"],ru:["\u04241(0.0)","X","2"]},formula:"bookformula3"},{prongs:{en:["H2(0.0)","X","1"],de:["AH2(0.0)","X","1"],fr:["HA2(0.0)","X","1"],ru:["\u04242(0.0)","X","1"]},formula:"bookformula3"},{prongs:{en:["H1(0.0)","X2","2"],de:["AH1(0.0)","X2","2"],fr:["HA1(0.0)","X2","2"],ru:["\u04241(0.0)","X2","2"]},formula:"bookformula4"},{prongs:{en:["H2(0.0)","1X","1"],de:["AH2(0.0)","1X","1"],fr:["HA2(0.0)","1X","1"],ru:["\u04242(0.0)",
"1X","1"]},formula:"bookformula4"},{prongs:{en:["Over 2.0","Under 2.5","Under 1.5"],de:["\u00dcber 2.0","Unter 2.5","Unter 1.5"],fr:["Tp(2.0)","Tm(2.5)","Tm(1.5)"],ru:["\u0422\u0431(2.0)","\u0422\u043c(2.5)","\u0422\u043c(1.5)"]},formula:"bookformula4"},{prongs:{en:["Under 2.0","Over 1.5","Over 2.5"],de:["Unter 2.0","\u00dcber 1.5","\u00dcber 2.5"],fr:["Tm(2.0)","Tp(1.5)","Tp(2.5)"],ru:["\u0422\u043c(2.0)","\u0422\u0431(1.5)","\u0422\u0431(2.5)"]},formula:"bookformula4"},{prongs:{en:["H1(-0.25)",
"X","2"],de:["AH1(-0.25)","X","2"],fr:["HA1(-0.25)","X","2"],ru:["\u04241(-0.25)","X","2"]},formula:"bookformula5"},{prongs:{en:["H2(-0.25)","X","1"],de:["AH2(-0.25)","X","1"],fr:["HA2(-0.25)","X","1"],ru:["\u04242(-0.25)","X","1"]},formula:"bookformula5"},{prongs:{en:["H1(-0.25)","X2","2"],de:["AH1(-0.25)","X2","2"],fr:["HA1(-0.25)","X2","2"],ru:["\u04241(-0.25)","X2","2"]},formula:"bookformula6"},{prongs:{en:["H2(-0.25)","1X","1"],de:["AH2(-0.25)","1X","1"],fr:["HA2(-0.25)","1X","1"],ru:["\u04242(-0.25)",
"1X","1"]},formula:"bookformula6"},{prongs:{en:["Over 2.25","Under 2.5","Under 1.5"],de:["\u00dcber 2.25","Unter 2.5","Unter 1.5"],fr:["Tp(2.25)","Tm(2.5)","Tm(1.5)"],ru:["\u0422\u0431(2.25)","\u0422\u043c(2.5)","\u0422\u043c(1.5)"]},formula:"bookformula6"},{prongs:{en:["Under 1.75","Over 1.5","Over 2.5"],de:["Unter 1.75","\u00dcber 1.5","\u00dcber 2.5"],fr:["Tm(1.75)","Tp(1.5)","Tp(2.5)"],ru:["\u0422\u043c(1.75)","\u0422\u0431(1.5)","\u0422\u0431(2.5)"]},formula:"bookformula6"},{prongs:{en:["H1(0.25)",
"X","2"],de:["AH1(0.25)","X","2"],fr:["HA1(0.25)","X","2"],ru:["\u04241(0.25)","X","2"]},formula:"bookformula7"},{prongs:{en:["H2(0.25)","X","1"],de:["AH2(0.25)","X","1"],fr:["HA2(0.25)","X","1"],ru:["\u04242(0.25)","X","1"]},formula:"bookformula7"},{prongs:{en:["H1(0.25)","X2","2"],de:["AH1(0.25)","X2","2"],fr:["HA1(0.25)","X2","2"],ru:["\u04241(0.25)","X2","2"]},formula:"bookformula8"},{prongs:{en:["H2(0.25)","1X","1"],de:["AH2(0.25)","1X","1"],fr:["HA2(0.25)","1X","1"],ru:["\u04242(0.25)","1X",
"1"]},formula:"bookformula8"},{prongs:{en:["Over 1.75","Under 2.5","Under 1.5"],de:["\u00dcber 1.75","Unter 2.5","Unter 1.5"],fr:["Tp(1.75)","Tm(2.5)","Tm(1.5)"],ru:["\u0422\u0431(1.75)","\u0422\u043c(2.5)","\u0422\u043c(1.5)"]},formula:"bookformula8"},{prongs:{en:["Under 2.25","Over 1.5","Over 2.5"],de:["Unter 2.25","\u00dcber 1.5","\u00dcber 2.5"],fr:["Tm(2.25)","Tp(1.5)","Tp(2.5)"],ru:["\u0422\u043c(2.25)","\u0422\u0431(1.5)","\u0422\u0431(2.5)"]},formula:"bookformula8"},{prongs:{en:["H1(-0.25)",
"X","H2(0.0)"],de:["AH1(-0.25)","X","AH2(0.0)"],fr:["HA1(-0.25)","X","HA2(0.0)"],ru:["\u04241(-0.25)","X","\u04242(0.0)"]},formula:"bookformula9"},{prongs:{en:["H2(-0.25)","X","H1(0.0)"],de:["AH2(-0.25)","X","AH1(0.0)"],fr:["HA2(-0.25)","X","HA1(0.0)"],ru:["\u04242(-0.25)","X","\u04241(0.0)"]},formula:"bookformula9"},{prongs:{en:["H1(-0.25)","X2","H2(0.0)"],de:["AH1(-0.25)","X2","AH2(0.0)"],fr:["HA1(-0.25)","X2","HA2(0.0)"],ru:["\u04241(-0.25)","X2","\u04242(0.0)"]},formula:"bookformula10"},{prongs:{en:["H2(-0.25)",
"1X","H1(0.0)"],de:["AH2(-0.25)","1X","AH1(0.0)"],fr:["HA2(-0.25)","1X","HA1(0.0)"],ru:["\u04242(-0.25)","1X","\u04241(0.0)"]},formula:"bookformula10"},{prongs:{en:["Under 1.75","Over 1.5","Over 2.0"],de:["Unter 1.75","\u00dcber 1.5","\u00dcber 2.0"],fr:["Tm(1.75)","Tp(1.5)","Tp(2.0)"],ru:["\u0422\u043c(1.75)","\u0422\u0431(1.5)","\u0422\u0431(2.0)"]},formula:"bookformula10"},{prongs:{en:["H1(-0.25)","X","H2(-0.25)"],de:["AH1(-0.25)","X","AH2(-0.25)"],fr:["HA1(-0.25)","X","HA2(-0.25)"],ru:["\u04241(-0.25)",
"X","\u04242(-0.25)"]},formula:"bookformula11"},{prongs:{en:["H1(-0.25)","X2","H2(-0.25)"],de:["AH1(-0.25)","X2","AH2(-0.25)"],fr:["HA1(-0.25)","X2","HA2(-0.25)"],ru:["\u04241(-0.25)","X2","\u04242(-0.25)"]},formula:"bookformula12"},{prongs:{en:["H2(-0.25)","1X","H1(-0.25)"],de:["AH2(-0.25)","1X","AH1(-0.25)"],fr:["HA2(-0.25)","1X","HA1(-0.25)"],ru:["\u04242(-0.25)","1X","\u04241(-0.25)"]},formula:"bookformula12"},{prongs:{en:["Over 2.25","Under 2.5","Under 1.75"],de:["\u00dcber 2.25","Unter 2.5",
"Unter 1.75"],fr:["Tp(2.25)","Tm(2.5)","Tm(1.75)"],ru:["\u0422\u0431(2.25)","\u0422\u043c(2.5)","\u0422\u043c(1.75)"]},formula:"bookformula12"},{prongs:{en:["H1(0.0)","H2(0.25)","2"],de:["AH1(0.0)","AH2(0.25)","2"],fr:["HA1(0.0)","HA2(0.25)","2"],ru:["\u04241(0.0)","\u04242(0.25)","2"]},formula:"bookformula13"},{prongs:{en:["H2(0.0)","H1(0.25)","1"],de:["AH2(0.0)","AH1(0.25)","1"],fr:["HA2(0.0)","HA1(0.25)","1"],ru:["\u04242(0.0)","\u04241(0.25)","1"]},formula:"bookformula13"},{prongs:{en:["Over 2.0",
"Under 2.25","Under 1.5"],de:["\u00dcber 2.0","Unter 2.25","Unter 1.5"],fr:["Tp(2.0)","Tm(2.25)","Tm(1.5)"],ru:["\u0422\u0431(2.0)","\u0422\u043c(2.25)","\u0422\u043c(1.5)"]},formula:"bookformula13"},{prongs:{en:["Under 2.0","Over 1.75","Over 2.5"],de:["Unter 2.0","\u00dcber 1.75","\u00dcber 2.5"],fr:["Tm(2.0)","Tp(1.75)","Tp(2.5)"],ru:["\u0422\u043c(2.0)","\u0422\u0431(1.75)","\u0422\u0431(2.5)"]},formula:"bookformula13"},{prongs:{en:["H1(0.0)","X2","H2(-0.25)"],de:["AH1(0.0)","X2","AH2(-0.25)"],
fr:["HA1(0.0)","X2","HA2(-0.25)"],ru:["\u04241(0.0)","X2","\u04242(-0.25)"]},formula:"bookformula14"},{prongs:{en:["H2(0.0)","1X","H1(-0.25)"],de:["AH2(0.0)","1X","AH1(-0.25)"],fr:["HA2(0.0)","1X","HA1(-0.25)"],ru:["\u04242(0.0)","1X","\u04241(-0.25)"]},formula:"bookformula14"},{prongs:{en:["Over 2.0","Under 2.5","Under 1.75"],de:["\u00dcber 2.0","Unter 2.5","Unter 1.75"],fr:["Tp(2.0)","Tm(2.5)","Tm(1.75)"],ru:["\u0422\u0431(2.0)","\u0422\u043c(2.5)","\u0422\u043c(1.75)"]},formula:"bookformula14"},
{prongs:{en:["Under 2.0","Over 1.5","Over 2.25"],de:["Unter 2.0","\u00dcber 1.5","\u00dcber 2.25"],fr:["Tm(2.0)","Tp(1.5)","Tp(2.25)"],ru:["\u0422\u043c(2.0)","\u0422\u0431(1.5)","\u0422\u0431(2.25)"]},formula:"bookformula14"},{prongs:{en:["H1(0.25)","H2(0.0)","2"],de:["AH1(0.25)","AH2(0.0)","2"],fr:["HA1(0.25)","HA2(0.0)","2"],ru:["\u04241(0.25)","\u04242(0.0)","2"]},formula:"bookformula15"},{prongs:{en:["H2(0.25)","H1(0.0)","1"],de:["AH2(0.25)","AH1(0.0)","1"],fr:["HA2(0.25)","HA1(0.0)","1"],ru:["\u04242(0.25)",
"\u04241(0.0)","1"]},formula:"bookformula15"},{prongs:{en:["Over 1.75","Under 2.0","Under 1.5"],de:["\u00dcber 1.75","Unter 2.0","Unter 1.5"],fr:["Tp(1.75)","Tm(2.0)","Tm(1.5)"],ru:["\u0422\u0431(1.75)","\u0422\u043c(2.0)","\u0422\u043c(1.5)"]},formula:"bookformula15"},{prongs:{en:["1X","12","X2"],de:["1X","12","X2"],fr:["1X","12","X2"],ru:["1X","12","X2"]},formula:"bookformula16"},{prongs:{en:["H1(0.25)","12","X2"],de:["AH1(0.25)","12","X2"],fr:["HA1(0.25)","12","X2"],ru:["\u04241(0.25)","12","X2"]},
formula:"bookformula17"},{prongs:{en:["H2(0.25)","12","1X"],de:["AH2(0.25)","12","1X"],fr:["HA2(0.25)","12","1X"],ru:["\u04242(0.25)","12","1X"]},formula:"bookformula17"},{prongs:{en:["H1(0.25)","12","H2(0.25)"],de:["AH1(0.25)","12","AH2(0.25)"],fr:["HA1(0.25)","12","HA2(0.25)"],ru:["\u04241(0.25)","12","\u04242(0.25)"]},formula:"bookformula18"},{prongs:{en:["H1(0.0)","12","X2"],de:["AH1(0.0)","12","X2"],fr:["HA1(0.0)","12","X2"],ru:["\u04241(0.0)","12","X2"]},formula:"bookformula19"},{prongs:{en:["H2(0.0)",
"12","1X"],de:["AH2(0.0)","12","1X"],fr:["HA2(0.0)","12","1X"],ru:["\u04242(0.0)","12","1X"]},formula:"bookformula19"},{prongs:{en:["H1(0.0)","12","H2(0.25)"],de:["AH1(0.0)","12","AH2(0.25)"],fr:["HA1(0.0)","12","HA2(0.25)"],ru:["\u04241(0.0)","12","\u04242(0.25)"]},formula:"bookformula20"},{prongs:{en:["H2(0.0)","12","H1(0.25)"],de:["AH2(0.0)","12","AH1(0.25)"],fr:["HA2(0.0)","12","HA1(0.25)"],ru:["\u04242(0.0)","12","\u04241(0.25)"]},formula:"bookformula20"},{prongs:{en:["Under 2.25","Over 1.75",
"Over 2.5"],de:["Unter 2.25","\u00dcber 1.75","\u00dcber 2.5"],fr:["Tm(2.25)","Tp(1.75)","Tp(2.5)"],ru:["\u0422\u043c(2.25)","\u0422\u0431(1.75)","\u0422\u0431(2.5)"]},formula:"bookformula21"},{prongs:{en:["0:2","1:2","2:0","2:1"],de:["0:2","1:2","2:0","2:1"],fr:["0:2","1:2","2:0","2:1"],ru:["0:2","1:2","2:0","2:1"]},formula:"universalFormulaSimple"},{prongs:{en:"0:3 1:3 2:3 3:0 3:1 3:2".split(" "),de:"0:3 1:3 2:3 3:0 3:1 3:2".split(" "),fr:"0:3 1:3 2:3 3:0 3:1 3:2".split(" "),ru:"0:3 1:3 2:3 3:0 3:1 3:2".split(" ")},
formula:"universalFormulaSimple"}],betBehaviours={"half-return":{getKoefficient:function(a){return-.5}},"half-win":{getKoefficient:function(a){return(a-1)/2}},lose:{getKoefficient:function(a){return-1}},"return":{getKoefficient:function(a){return 0}},win:{getKoefficient:function(a){return a-1}}};
(function(){Math.frac=function(a,b){var c,d=parseFloat(a),e=parseInt(b);c=d;var g,f=[[1,0],[0,1]];if(0>=e)throw"Max denominator should be greater then 0";for(;f[1][0]*(g=parseInt(d))+f[1][1]<=e;){var h=f[0][0]*g+f[0][1];f[0][1]=f[0][0];f[0][0]=h;h=f[1][0]*g+f[1][1];f[1][1]=f[1][0];f[1][0]=h;if(d==g)break;d=1/(d-g);if(2147483647<d)break}d=f[0][0];h=f[1][0];g=(e-f[1][1])/f[1][0];f[0][0]=f[0][0]*g+f[0][1];f[1][0]=f[1][0]*g+f[1][1];e=f[0][0];f=f[1][0];c=[c-d/h,[d,h],c-e/f,[e,f]];return Math.abs(c[0])<
Math.abs(c[2])?c[1]:c[3]}})();
oddFormats={eu:{toDecimal:function(a){return Number(a)},fromDecimal:function(a){return Number(a).toFixed(3)}},us:{toDecimal:function(a){a=Number(a);return 0<=a?(a+100)/100:(100+Math.abs(a))/Math.abs(a)},fromDecimal:function(a){a=Number(2<=a?100*(a-1):-100/(a-1)).toFixed(0);return 0<a?"+"+a:a}},uk:{toDecimal:function(a){a=a.split("/");return parseFloat(a[0])/parseFloat(a[1])+1},fromDecimal:function(a){a=Math.frac(a-1,100);return a[0]+"/"+a[1]}},hk:{toDecimal:function(a){return(Number(a)+1).toFixed(3)},
fromDecimal:function(a){return(Number(a)-1).toFixed(3)}}};var genOnValueChange=function(a,b,c){return function(){var d=oddFormats[b].toDecimal(fixDelimiter($(a).val())),e=c?layConverter(d):d,d=c?d:layConverter(d),g;for(g in oddFormats){var f=oddFormats[g];(b!=g||c)&&$("#"+g+"_back").val(f.fromDecimal(e));b==g&&c||$("#"+g+"_lay").val(f.fromDecimal(d))}}},layConverter=function(a){return a/(a-1)},i;
for(i in oddFormats){var backId="#"+i+"_back",layId="#"+i+"_lay";$(document).on("keyup",backId,genOnValueChange(backId,i,!1)).on("keyup",layId,genOnValueChange(layId,i,!0))}
var ZeroClipboard={version:"1.0.7",clients:{},moviePath:"ZeroClipboard.swf",nextId:1,$:function(a){"string"==typeof a&&(a=document.getElementById(a));a.addClass||(a.hide=function(){this.style.display="none"},a.show=function(){this.style.display=""},a.addClass=function(a){this.removeClass(a);this.className+=" "+a},a.removeClass=function(a){for(var c=this.className.split(/\s+/),d=-1,e=0;e<c.length;e++)c[e]==a&&(d=e,e=c.length);-1<d&&(c.splice(d,1),this.className=c.join(" "));return this},a.hasClass=
function(a){return!!this.className.match(new RegExp("\\s*"+a+"\\s*"))});return a},setMoviePath:function(a){this.moviePath=a},dispatch:function(a,b,c){(a=this.clients[a])&&a.receiveEvent(b,c)},register:function(a,b){this.clients[a]=b},getDOMObjectPosition:function(a,b){for(var c={left:0,top:0,width:a.width?a.width:a.offsetWidth,height:a.height?a.height:a.offsetHeight};a&&a!=b;)c.left+=a.offsetLeft,c.top+=a.offsetTop,a=a.offsetParent;return c},Client:function(a){this.handlers={};this.id=ZeroClipboard.nextId++;
this.movieId="ZeroClipboardMovie_"+this.id;ZeroClipboard.register(this.id,this);a&&this.glue(a)}};
ZeroClipboard.Client.prototype={id:0,ready:!1,movie:null,clipText:"",handCursorEnabled:!0,cssEffects:!0,handlers:null,glue:function(a,b,c){this.domElement=ZeroClipboard.$(a);a=99;this.domElement.style.zIndex&&(a=parseInt(this.domElement.style.zIndex,10)+1);"string"==typeof b?b=ZeroClipboard.$(b):"undefined"==typeof b&&(b=document.getElementsByTagName("body")[0]);var d=ZeroClipboard.getDOMObjectPosition(this.domElement,b);this.div=document.createElement("div");var e=this.div.style;e.position="absolute";
e.left=""+d.left+"px";e.top=""+d.top+"px";e.width=""+d.width+"px";e.height=""+d.height+"px";e.zIndex=a;if("object"==typeof c)for(addedStyle in c)e[addedStyle]=c[addedStyle];b.appendChild(this.div);this.div.innerHTML=this.getHTML(d.width,d.height)},getHTML:function(a,b){var c="",d="id="+this.id+"&width="+a+"&height="+b;if(navigator.userAgent.match(/MSIE/))var e=location.href.match(/^https/i)?"https://":"http://",c=c+('<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+e+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+
a+'" height="'+b+'" id="'+this.movieId+'" align="middle"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+ZeroClipboard.moviePath+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+d+'"/><param name="wmode" value="transparent"/></object>');else c+='<embed id="'+this.movieId+'" src="'+ZeroClipboard.moviePath+
'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+a+'" height="'+b+'" name="'+this.movieId+'" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+d+'" wmode="transparent" />';return c},hide:function(){this.div&&(this.div.style.left="-2000px")},show:function(){this.reposition()},destroy:function(){if(this.domElement&&this.div){this.hide();this.div.innerHTML=
"";var a=document.getElementsByTagName("body")[0];try{a.removeChild(this.div)}catch(b){}this.div=this.domElement=null}},reposition:function(a){a&&((this.domElement=ZeroClipboard.$(a))||this.hide());if(this.domElement&&this.div){a=ZeroClipboard.getDOMObjectPosition(this.domElement);var b=this.div.style;b.left=""+a.left+"px";b.top=""+a.top+"px"}},setText:function(a){this.clipText=a;this.ready&&this.movie.setText(a)},addEventListener:function(a,b){a=a.toString().toLowerCase().replace(/^on/,"");this.handlers[a]||
(this.handlers[a]=[]);this.handlers[a].push(b)},setHandCursor:function(a){this.handCursorEnabled=a;this.ready&&this.movie.setHandCursor(a)},setCSSEffects:function(a){this.cssEffects=!!a},receiveEvent:function(a,b){a=a.toString().toLowerCase().replace(/^on/,"");switch(a){case "load":this.movie=document.getElementById(this.movieId);if(!this.movie){var c=this;setTimeout(function(){c.receiveEvent("load",null)},1);return}if(!this.ready&&navigator.userAgent.match(/Firefox/)&&navigator.userAgent.match(/Windows/)){c=
this;setTimeout(function(){c.receiveEvent("load",null)},100);this.ready=!0;return}this.ready=!0;this.movie.setText(this.clipText);this.movie.setHandCursor(this.handCursorEnabled);break;case "mouseover":this.domElement&&this.cssEffects&&(this.domElement.addClass("hover"),this.recoverActive&&this.domElement.addClass("active"));break;case "mouseout":this.domElement&&this.cssEffects&&(this.recoverActive=!1,this.domElement.hasClass("active")&&(this.domElement.removeClass("active"),this.recoverActive=!0),
this.domElement.removeClass("hover"));break;case "mousedown":this.domElement&&this.cssEffects&&this.domElement.addClass("active");break;case "mouseup":this.domElement&&this.cssEffects&&(this.domElement.removeClass("active"),this.recoverActive=!1)}if(this.handlers[a])for(var d=0,e=this.handlers[a].length;d<e;d++){var g=this.handlers[a][d];if("function"==typeof g)g(this,b);else if("object"==typeof g&&2==g.length)g[0][g[1]](this,b);else if("string"==typeof g)window[g](this,b)}}};
function fixDelimiter(a){return a.replace(/,/g,".").replace(/[\s_]/g,"")}$(function(){"undefined"!=typeof Calculator&&(Calculator.onInit(),initCalculator())});function initFromRemote(a){}window.initFromRemote=initFromRemote;
var initCalculator=function(a){function b(){for(var b=a("#calc_table"),c=Calculator.formulaName,d=Calculator.prongsAmount,e=Calculator.currencies,g=e.slice(),f=0;f<e.length;f++)g[f]=e[f].slice();for(f=0;f<g.length;f++)for(var h=0;h<g[f].length;h++){var q=v("exch_"+f+"_"+h);null!=q&&0!=q&&(0<q?(g[f][h]=q,g[h][f]=1/q):(g[h][f]=-q,g[f][h]=-1/q))}f=Calculator.oddFormat;"middle"==c?(b.data("isMiddle",!0),b.data("winBetBehaviours",Calculator.winBetBehaviours),b.data("formulaName","bookformula1")):(b.data("isMiddle",
!1),b.data("formulaName",c));b.data("prongsAmount",d);b.data("currencies",e);b.data("userCurrencies",g);b.data("oddFormat",f);return b}function c(b){var c={};0<a("#copy_button").size()&&"undefined"!=typeof zeroClipBoardPath&&(ZeroClipboard.setMoviePath(zeroClipBoardPath),c=new ZeroClipboard.Client,c.setText(""),c.setHandCursor(!0),c.setCSSEffects(!0),c.addEventListener("mouseDown",function(a){a.setText(T(b))}),c.glue("copy_button"));return c}function d(b,c){if(c.data("lay")){var d=a(c).parent().parent().attr("data-number"),
e=P(b,d),e=Number(fixDelimiter(c.val()))/(e-1);b.find("tr.backers_prong[data-number='"+d+"'] input.backers_stake").val(t(e))}}function e(b){null==b&&(b=a("#calc_table"));var c;c=b;var d=$M(c.data("matrix")),e=$M([l(c)]).transpose(),f=c.find("input[name='fixed-value']:checked").val(),p=d.inverse();if(p)e=p.x(e);else{e=d.toRightTriangular();d=d.rows();p=Array(d);p[d-1]=[1];for(var u=d-1;0<u;u--){for(var q=0,E=d;E>u;E--)q-=e.e(u,E)*p[E-1][0];p[u-1]=[q/e.e(u,u)]}e=$M(p)}if(d=e){e=!1;"sum"==f?(f=fixDelimiter(c.find("input.sum").val()),
d=d.x(f/k(d))):(e=!0,f=Number(f),p=r(c,F(c))[f],d=d.x(p/d.e(f+1,1)));f=x(c,h(d));d=Array(f.length);for(p=0;p<f.length;p++)d[p]=[f[p]];d=$M(d);a("#round").prop("checked")&&(d=a("#roundSmart").prop("checked")?d.round(U(c)):d.round(fixDelimiter(a("#roundTo").val())));m(c,h(d));e&&G(c,H(c));c=!0}else c=!1;c&&g(b)}function g(a){var b=r(a,F(a)),c=$M(a.data("matrix")),d=$M([b]).transpose(),c=h(c.x(d));V(a,x(a,c));if(a.data("isMiddle")){for(var c=a.data("koeffsWithCommission"),d=a.data("winBetBehaviours"),
e=Array(b.length),f=0,g=0;g<b.length;g++)e[g]=betBehaviours[d[g]].getKoefficient(c[g])*b[g],f+=e[g];n(a,x(a,e));b=f;a.find("span.winSum").text(t(b))}}function f(b,c){var d=function(c){var d=a.culture.numberFormat.currency.pattern[1],e=B(b)?b.data("userCurrencies"):b.data("currencies"),f=a(c).val(),g=y(b);if(f!=g){e=e[g][f];g=a("select.sum-currency option:selected",b).text();f=a("option:selected",c).text();if(1>e)var e=1/e,S=g,g=f,f=S;g=d.replace("n"," 1 ").replace("$",g);d=d.replace("n"," "+t(e)+
" ").replace("$",f);a(c).attr("title",g+" = "+d)}else a(c).attr("title","")};return function(){c?a("tr.prong select.booker-currency",b).each(function(){d(this)}):d(this)}}function h(a){for(var b=[],c=0;c<a.rows();c++)b[c]=a.e(c+1,1);return b}function k(a){for(var b=0,c=0;c<a.rows();c++)b+=a.e(c+1,1);return b}function l(b){return b.find("tr.prong input.distribution").map(function(b){return a(this).prop("checked")?1:0})}function m(b,c){b.find("tr.prong input.stake").each(function(e){a(this).val(t(c[e]));
d(b,a(this))})}function n(b,c){b.find("tr.prong span.win").each(function(b){a(this).text(t(c[b]))})}function x(a,b){for(var c=Array(b.length),d=B(a)?a.data("userCurrencies"):a.data("currencies"),e=C(a),f=y(a),g=0;g<b.length;g++)c[g]=b[g]*d[f][e[g]];return c}function r(a,b){for(var c=Array(b.length),d=B(a)?a.data("userCurrencies"):a.data("currencies"),e=C(a),g=y(a),f=0;f<b.length;f++)c[f]=b[f]/d[g][e[f]];return c}function O(a,b){return oddFormats[a.data("oddFormat")].toDecimal(b)}function W(a,b){return oddFormats[a.data("oddFormat")].fromDecimal(b)}
function F(b){return b.find("tr.prong input.stake").map(function(b){return fixDelimiter(a(this).val())})}function V(b,c){b.find("tr.prong span.prize").each(function(d){var e=t(c[d]);a(this).text(e).css("color",0>e&&!b.data("isMiddle")?"red":"black");a(this).text(t(c[d]))})}function t(a,b){b||(b=2);return Number(a).toFixed(b)}function I(a){var b=Math.abs(a),c=(Number(b).toFixed()+"").length,d=3;if(1>b&&0<b)for(;1>b;)d++,b*=10;else d=3<c?0:4-c;return Number(a).toFixed(d)}function B(b){return a("#editCurrencies").prop("checked")}
function H(b){var c=0;a(r(b,F(b))).each(function(){c+=1*this});return c}function G(a,b){a.find("input.sum").val(t(b))}function P(a,b){return O(a,fixDelimiter(a.find('tr.prong[data-number="'+b+'"] input.koefficient').val()))}function X(b){return b.find("tr.prong input.koefficient").map(function(){var c=O(b,fixDelimiter(a(this).val()));a(this).data("lay")&&(c=1!=c?c/(c-1):1);return c})}function Y(b){var c=X(b);return b.find("tr.prong input.commission").map(function(b){var d=.01*fixDelimiter(a(this).val());
return 0<d?c[b]*(1-d)+d:c[b]*(1+d)})}function Z(b,c){b.data("koeffsWithCommission",c);b.find("tr.prong span.koefficient_with_commission").each(function(d){a(this).text(W(b,t(c[d],3)))})}function C(b){return b.find("tr.prong select.booker-currency").map(function(){return a(this).val()})}function y(a){return a.find("select.sum-currency").val()}function aa(b,c){return b.find("tr.prong select.booker-currency").each(function(b){null!=c[b]&&a(this).val(c[b])})}function ba(b){for(var c=J(b),d=[],e=[],f=
0;f<c.length;f++)e[f]=v("comission_"+c[f]),d[f]=v("currency_"+c[f]);ca(b,e);c=v("currency_sum");aa(b,d);c&&b.find("select.sum-currency").val(c);a("#editCurrencies").prop("checked","true"==v("calculator_editCurriencies"));a("#round").prop("checked","true"==v("calculator_round"));b=v("calculator_roundTo");null!=b&&K(fixDelimiter(b))&&a("#roundTo").val(b);a("#roundSmart").prop("checked","true"==v("calculator_roundSmart"))}function U(b){var c=fixDelimiter(a("#roundTo").val()),d=b.data("currencies"),e=
C(b);b=y(b);for(var f=Array(e.length),g=0;g<e.length;g++)if(b==e[g])f[g]=c;else{var h=c*d[b][e[g]],k=Math.pow(10,Math.floor(Math.log(h)/Math.log(10))),h=Math.round(h/(5*k));f[g]=0==h?k:h*k*5}return f}function v(a){return Calculator.settings?Calculator.settings[a]:null}function w(b,c){if(Calculator.settings){var d=a("#mini-header a");a.ajax({type:"POST",url:"/user_settings/set",data:{key:b,value:c},beforeSend:function(b){a(d).spinIncr()}}).always(function(a){d.spinDecr()})}}function J(b){return b.find("tr.prong").map(function(b){return a(this).data("booker-id")})}
function da(b){return b.find("tr.prong td.booker_c").map(function(b){return a(this).text()})}function Q(b){return b.find("tr.prong input.commission").map(function(){return fixDelimiter(a(this).val())})}function ca(b,c){return b.find("tr.prong input.commission").each(function(b){null!=c[b]&&K(fixDelimiter(c[b]))&&a(this).val(fixDelimiter(c[b]))})}function K(a){return a-0==a&&0<a.length}function ea(a,b){for(var c=Array(b),d=0;d<b;d++){var e=a.find("tr.backers_prong[data-number='"+d+"'] input.backers_stake");
c[d]=0<e.size()?fixDelimiter(e.val()):0}return c}function T(b){var c=a("#timestamp").text(),d=a("h1.title span.calc_event").text(),e=a("h1.title span.calc_turnir").text(),f=da(b),g=b.find("tr.prong td.coeff_name").map(function(){return a(this).text()}),h=b.find("tr.prong input.koefficient").map(function(){return fixDelimiter(a(this).val())}),k=Q(b),l=b.find("tr.prong span.koefficient_with_commission").map(function(){return a(this).text()}),D=F(b),A=ea(b,h.length),z=b.find("tr.prong select.booker-currency  option:selected").map(function(){return a(this).text()}),
fa=b.find("tr.prong span.prize").map(function(){return a(this).text()}),R=[],m=0;b.data("isMiddle")&&(R=b.find("tr.prong span.win").map(function(b){return a(this).text()}),m=b.find("span.winSum").text());for(var n=fixDelimiter(b.find("input.sum").val()),t=b.find("select.sum-currency option:selected").text(),c=c+"\t"+d+"\t"+e+"\n",d=0;d<f.length;d++)c+=f[d]+"\t"+g[d]+"\t"+h[d]+"\t"+k[d]+"\t"+l[d]+"\t"+D[d]+"\t"+A[d]+"\t"+z[d]+"\t"+fa[d],b.data("isMiddle")&&(c+="\t"+R[d]),c+="\n";c+="\t\t\t\t\t"+n+
"\t\t"+t;b.data("isMiddle")&&(c+="\t\t"+m);return c+"\n"}function L(a,b){var c=a.find(".currency_c");b?c.show():c.hide()}function M(b){var c=b.data("userCurrencies"),d=C(b),e=y(b),f=b.find("tr.prong .currency_c input.currency"),g=a("select.sum-currency option:selected",b).text();b=a("tr.prong select.booker-currency option:selected",b);for(var h=a("tr.prong input.currency_direction"),k=0;k<d.length;k++){a(h[k]).attr("data-currency",d[k]);a(f[k]).attr("data-currency",d[k]);var l=g,D=a(b[k]).text();
if(d[k]!=e){var A=c[d[k]][e],z=a(h[k]).data("revert");("auto"==z||"undefined"===typeof z)&&1>A||1==z?(a(h[k]).data("revert",!0),A=1/A,z=l,l=D,D=z):a(h[k]).data("revert",!1);a(h[k]).removeAttr("disabled");a(f[k]).removeAttr("disabled");a(f[k]).val(I(A))}else a(h[k]).attr("disabled",!0),a(f[k]).attr("disabled",!0),a(f[k]).val("1");a(h[k]).val(D+" / "+l)}}function N(a,b,c){0>=c&&(c="");if(a>b){var d=a;a=b;b=d;0<c&&(c=-c)}w("exch_"+a+"_"+b,c)}a(function(){var b=a("#calc_table").outerWidth()+50;null!=
b&&b>window.outerWidth&&window.resizeTo(b+50,window.outerHeight)});return function(){Calculator.calculateBets=e;var h=b(),k=c(h);ba(h);var l=function(){e(h)},m=function(){M(h);for(var a=J(h),b=C(h),c=y(h),d=0;d<a.length;d++)w("currency_"+a[d],b[d]);w("currency_sum",c);e(h)},n=function(){var a=Y(h);Z(h,a);var b=h.data("formulaName"),c=h.data("prongsAmount"),a=formulas[b].getMatrix(a,c);h.data("matrix",a);l()},p=function(){a("#round").prop("checked")?(a("#roundTo").removeAttr("disabled"),a("#roundSmart").removeAttr("disabled")):
(a("#roundTo").attr("disabled",!0),a("#roundSmart").attr("disabled",!0))};L(h,B(h));M(h);p();n();var u=f(h,!0);u();a("#calc_table input.sum").keyup(function(){h.find("input[name='fixed-value']").prop("checked",!1);h.find("input[name='fixed-value']:last").prop("checked",!0);e(h)});a("#editCurrencies").click(function(){var b=a(this).prop("checked");w("calculator_editCurriencies",b);L(h,b);l()});a("#round").click(function(){var b=a(this).prop("checked");w("calculator_round",b);p()});a("#roundSmart").click(function(){var b=
a(this).prop("checked");w("calculator_roundSmart",b)});a("#roundTo").keyup(function(){var b=a(this).val();w("calculator_roundTo",K(b)?b:1);l()});a("#calc_table input[type=checkbox], #round, #roundSmart").click(l);a("input#calculate").click(l);a("#calc_table select.booker-currency").change(function(){var b=a(this).parent().parent().attr("data-number"),c=a(this).val(),c=h.find("tr.prong input.currency_direction[data-currency="+c+"]");a(h.find("tr.prong input.currency_direction")[b]).data("revert",0<
c.length?a(c[0]).data("revert"):"auto");m(h)}).change(f(h,!1));a("#calc_table select.sum-currency").change(function(){a("input.currency_direction").data("revert","auto");m()}).change(u);a("#calc_table input.fixed-value").change(l);a("#copy_button").mouseover(function(){k.reposition()});a("#calc_table input.stake").keyup(function(){d(h,a(this));G(h,H(h));g(h)});a("#calc_table input.backers_stake").keyup(function(){var b=a(this),c=a(b).parent().parent().attr("data-number"),d=P(h,c),b=Number(fixDelimiter(b.val()))*
(d-1);h.find("tr.prong[data-number='"+c+"'] input.stake").val(t(b));G(h,H(h));g(h)});a("#calc_table input.koefficient").keyup(n);a("#calc_table input.commission").keyup(function(){for(var a=J(h),b=Q(h),c=0;c<a.length;c++)w("comission_"+a[c],b[c]);n()});a("#mass_check").click(function(){var b=a(this).prop("checked");a("#calc_table input.distribution").each(function(){a(this).prop("checked",b)});l()});a("#calc_table input.currency_direction").click(function(){var b=a(this).data("revert");b||(b=!1);
var b=!b,c=a(this).attr("data-currency");h.find("tr.prong input.currency_direction[data-currency="+c+"]").data("revert",b);m()});a("#calc_table input.back_lay").click(function(){var b=a(this).data("lay");b||(b=!1);b=!b;a(this).data("lay",b);var c=a(this).parent().parent(),d=c.attr("data-number");console.log(d);b?(a(this).val("-"),a("#calc_table tr.backersPattern").clone(!0).attr("class","backers_prong").attr("data-number",d).insertAfter(c),c.find("input.koefficient").data("lay",!0),c.find("input.stake").data("lay",
!0),c.find(".minor").show()):(a(this).val("+"),c.next("tr.backers_prong").remove(),c.find("input.koefficient").removeData("lay"),c.find("input.stake").removeData("lay"),c.find(".minor").hide());n()});a("#calc_table input.currency").keyup(function(){var b=a(this).val(),c=a(this).attr("data-currency"),d=a(this).parent().parent().attr("data-number"),e=fixDelimiter(a(this).val()),d=a(h.find("tr.prong input.currency_direction")[d]).data("revert"),f=y(h),g=h.data("userCurrencies");if(0<e)if(d){if(g[f][c]!=
e||g[c][f]!=1/e)g[f][c]=e,g[c][f]=1/e,N(f,c,e)}else{if(g[c][f]!=e||g[f][c]!=1/e)g[c][f]=e,g[f][c]=1/e,N(c,f,e)}else if(0!=e){var k=h.data("currencies");g[f][c]=k[f][c];g[c][f]=k[c][f];b=d?I(k[f][c]):I(k[c][f]);N(f,c,e)}a(this);a("#calc_table tr.prong input.currency[data-currency="+c+"]").each(function(){a(this).val()!=b&&a(this).val(b)});l();u()});if(a("select.prongs_amount")){var q=function(){if(window.forktypes){for(var b=0,c=a("select.prongs_amount").val(),d=!0,e=a("select.fork_type").children().remove().end(),
b=0;b<forktypes.length;b++){var f=forktypes[b].prongs[Calculator.locale];if(f.length==c||4==c&&f.length>c)f=f.join(" - "),d?(e.append(a("<option/>").attr("value",b).text(f).prop("selected",!0)),d=!1):e.append(a("<option/>").attr("value",b).text(f))}r()}},r=function(){var c=a("select.fork_type").val();if(c){var d=forktypes[c].prongs[Calculator.locale].length,e=d!=Calculator.prongsAmount;Calculator.prongsAmount=d;Calculator.formulaName=forktypes[c].formula;var d=0,f;e&&(a("#calc_table tr.backers_prong").remove(),
a("#calc_table tr.prong").remove());for(d=0;d<Calculator.prongsAmount;d++)e?(f=a("#calc_table tr.rowPattern").clone(!0).attr("class","prong").attr("data-number",d),f.find(".minor").hide(),f.find("input.koefficient").val(Calculator.prongsAmount),f.find("input.fixed-value").val(d).prop("checked",!1),f.insertBefore("#calc_table tr.summarize")):f=a("#calc_table tr.prong:eq("+d+")"),f.find("td .koefficient_descr").html(forktypes[c].prongs[Calculator.locale][d]);e&&a("#calc_table input.fixed-value:last").prop("checked",
!0);b();n();L(h,B(h));M(h)}};a("select.prongs_amount").change(q);a("select.fork_type").change(r);q()}}}(jQuery);
